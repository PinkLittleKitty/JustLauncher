<Window x:Class="JustLauncher.InstallationDialog"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        Title="New Installation" Height="650" Width="700"
        WindowStartupLocation="CenterOwner" 
        WindowStyle="None"
        AllowsTransparency="True"
        Background="Transparent"
        ResizeMode="NoResize">
    
    <Window.Resources>
        <!-- Modern TextBox Style -->
        <Style x:Key="ModernTextBox" TargetType="TextBox">
            <Setter Property="Background" Value="#2A2A2A"/>
            <Setter Property="Foreground" Value="White"/>
            <Setter Property="BorderBrush" Value="#404040"/>
            <Setter Property="BorderThickness" Value="1"/>
            <Setter Property="Padding" Value="12,10"/>
            <Setter Property="FontSize" Value="14"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="TextBox">
                        <Border Background="{TemplateBinding Background}"
                                BorderBrush="{TemplateBinding BorderBrush}"
                                BorderThickness="{TemplateBinding BorderThickness}"
                                CornerRadius="6">
                            <ScrollViewer x:Name="PART_ContentHost" 
                                        Margin="{TemplateBinding Padding}"/>
                        </Border>
                        <ControlTemplate.Triggers>
                            <Trigger Property="IsFocused" Value="True">
                                <Setter Property="BorderBrush" Value="#00C851"/>
                            </Trigger>
                            <Trigger Property="IsMouseOver" Value="True">
                                <Setter Property="BorderBrush" Value="#606060"/>
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>

        <!-- Modern ComboBox Style -->
        <Style x:Key="ModernComboBox" TargetType="ComboBox">
            <Setter Property="Background" Value="#2A2A2A"/>
            <Setter Property="Foreground" Value="White"/>
            <Setter Property="BorderBrush" Value="#404040"/>
            <Setter Property="BorderThickness" Value="1"/>
            <Setter Property="Padding" Value="12,10"/>
            <Setter Property="FontSize" Value="14"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="ComboBox">
                        <Border Background="{TemplateBinding Background}"
                                BorderBrush="{TemplateBinding BorderBrush}"
                                BorderThickness="{TemplateBinding BorderThickness}"
                                CornerRadius="6">
                            <Grid>
                                <ToggleButton x:Name="ToggleButton" 
                                            Background="Transparent"
                                            BorderThickness="0"
                                            IsChecked="{Binding Path=IsDropDownOpen, Mode=TwoWay, RelativeSource={RelativeSource TemplatedParent}}"
                                            ClickMode="Press"/>
                                <ContentPresenter x:Name="ContentSite"
                                                IsHitTestVisible="False"
                                                Content="{TemplateBinding SelectionBoxItem}"
                                                ContentTemplate="{TemplateBinding SelectionBoxItemTemplate}"
                                                ContentTemplateSelector="{TemplateBinding ItemTemplateSelector}"
                                                Margin="{TemplateBinding Padding}"
                                                VerticalAlignment="Center"
                                                HorizontalAlignment="Left"/>
                                <TextBox x:Name="PART_EditableTextBox"
                                       Style="{x:Null}"
                                       Background="Transparent"
                                       Visibility="Hidden"
                                       IsReadOnly="{TemplateBinding IsReadOnly}"/>
                                <Popup x:Name="Popup"
                                     Placement="Bottom"
                                     IsOpen="{TemplateBinding IsDropDownOpen}"
                                     AllowsTransparency="True"
                                     Focusable="False"
                                     PopupAnimation="Slide">
                                    <Grid MaxHeight="200" MinWidth="{TemplateBinding ActualWidth}">
                                        <Border Background="#2A2A2A" BorderBrush="#404040" BorderThickness="1" CornerRadius="6">
                                            <ScrollViewer>
                                                <StackPanel IsItemsHost="True"/>
                                            </ScrollViewer>
                                        </Border>
                                    </Grid>
                                </Popup>
                            </Grid>
                        </Border>
                        <ControlTemplate.Triggers>
                            <Trigger Property="IsFocused" Value="True">
                                <Setter Property="BorderBrush" Value="#00C851"/>
                            </Trigger>
                            <Trigger Property="IsMouseOver" Value="True">
                                <Setter Property="BorderBrush" Value="#606060"/>
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>

        <!-- Modern Button Style -->
        <Style x:Key="ModernButton" TargetType="Button">
            <Setter Property="Background" Value="#3A3A3A"/>
            <Setter Property="Foreground" Value="White"/>
            <Setter Property="BorderThickness" Value="0"/>
            <Setter Property="Padding" Value="15,10"/>
            <Setter Property="FontWeight" Value="Medium"/>
            <Setter Property="FontSize" Value="14"/>
            <Setter Property="Cursor" Value="Hand"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="Button">
                        <Border Background="{TemplateBinding Background}" 
                                CornerRadius="6"
                                BorderThickness="{TemplateBinding BorderThickness}"
                                BorderBrush="{TemplateBinding BorderBrush}">
                            <ContentPresenter HorizontalAlignment="Center" 
                                            VerticalAlignment="Center"/>
                        </Border>
                        <ControlTemplate.Triggers>
                            <Trigger Property="IsMouseOver" Value="True">
                                <Setter Property="Background" Value="#4A4A4A"/>
                            </Trigger>
                            <Trigger Property="IsPressed" Value="True">
                                <Setter Property="Background" Value="#2A2A2A"/>
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>

        <!-- Primary Button Style -->
        <Style x:Key="PrimaryButton" TargetType="Button" BasedOn="{StaticResource ModernButton}">
            <Setter Property="Background" Value="#00C851"/>
            <Setter Property="FontWeight" Value="Bold"/>
            <Style.Triggers>
                <Trigger Property="IsMouseOver" Value="True">
                    <Setter Property="Background" Value="#00A041"/>
                </Trigger>
                <Trigger Property="IsPressed" Value="True">
                    <Setter Property="Background" Value="#008A31"/>
                </Trigger>
            </Style.Triggers>
        </Style>

        <!-- Secondary Button Style -->
        <Style x:Key="SecondaryButton" TargetType="Button" BasedOn="{StaticResource ModernButton}">
            <Setter Property="Background" Value="#2196F3"/>
            <Style.Triggers>
                <Trigger Property="IsMouseOver" Value="True">
                    <Setter Property="Background" Value="#1976D2"/>
                </Trigger>
                <Trigger Property="IsPressed" Value="True">
                    <Setter Property="Background" Value="#1565C0"/>
                </Trigger>
            </Style.Triggers>
        </Style>

        <!-- Modern CheckBox Style -->
        <Style TargetType="CheckBox">
            <Setter Property="Foreground" Value="White"/>
            <Setter Property="FontSize" Value="14"/>
            <Setter Property="VerticalContentAlignment" Value="Center"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="CheckBox">
                        <StackPanel Orientation="Horizontal">
                            <Border x:Name="CheckBoxBorder" Width="18" Height="18" 
                                    Background="#2A2A2A" BorderBrush="#404040" BorderThickness="1" 
                                    CornerRadius="3" Margin="0,0,8,0">
                                <Path x:Name="CheckMark" Data="M 2 6 L 6 10 L 14 2" 
                                      Stroke="#00C851" StrokeThickness="2" 
                                      Visibility="Collapsed"/>
                            </Border>
                            <ContentPresenter VerticalAlignment="Center"/>
                        </StackPanel>
                        <ControlTemplate.Triggers>
                            <Trigger Property="IsChecked" Value="True">
                                <Setter TargetName="CheckMark" Property="Visibility" Value="Visible"/>
                                <Setter TargetName="CheckBoxBorder" Property="Background" Value="#1A4A2E"/>
                                <Setter TargetName="CheckBoxBorder" Property="BorderBrush" Value="#00C851"/>
                            </Trigger>
                            <Trigger Property="IsMouseOver" Value="True">
                                <Setter TargetName="CheckBoxBorder" Property="BorderBrush" Value="#606060"/>
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>
    </Window.Resources>
    
    <Border Background="#23272A" CornerRadius="12" BorderBrush="#404040" BorderThickness="1">
        <Grid Margin="30">
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="*"/>
                <RowDefinition Height="Auto"/>
            </Grid.RowDefinitions>

            <!-- Header -->
            <Grid Grid.Row="0" Margin="0,0,0,30">
                <StackPanel>
                    <TextBlock x:Name="DialogTitle" Text="Create New Installation" FontSize="24" FontWeight="Bold" Foreground="White"/>
                    <TextBlock Text="Configure your Minecraft installation settings" FontSize="14" Foreground="Gray" Margin="0,5,0,0"/>
                </StackPanel>
                <Button Content="âœ•" HorizontalAlignment="Right" VerticalAlignment="Top" 
                        Background="Transparent" Foreground="#999" BorderThickness="0" 
                        FontSize="18" Padding="10" Click="CloseButton_Click"
                        Style="{StaticResource ModernButton}"/>
            </Grid>

            <!-- Form -->
            <ScrollViewer Grid.Row="1" VerticalScrollBarVisibility="Auto" Margin="0,0,0,20">
                <Grid>
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="20"/>
                        <ColumnDefinition Width="*"/>
                    </Grid.ColumnDefinitions>

                    <!-- Left Column -->
                    <StackPanel Grid.Column="0">
                        <!-- Installation Name -->
                        <TextBlock Text="Installation Name" Foreground="White" FontWeight="SemiBold" Margin="0,0,0,8"/>
                        <TextBox x:Name="NameTextBox" Style="{StaticResource ModernTextBox}" Margin="0,0,0,20"/>

                        <!-- Version Filter -->
                        <TextBlock Text="Version Filter" Foreground="White" FontWeight="SemiBold" Margin="0,0,0,8"/>
                        <StackPanel Orientation="Horizontal" Margin="0,0,0,15">
                            <CheckBox x:Name="ShowReleasesCheckBox" Content="Releases" Foreground="White" 
                                      IsChecked="True" Margin="0,0,20,0" Checked="VersionFilter_Changed" Unchecked="VersionFilter_Changed"/>
                            <CheckBox x:Name="ShowSnapshotsCheckBox" Content="Snapshots" Foreground="White" 
                                      IsChecked="False" Margin="0,0,20,0" Checked="VersionFilter_Changed" Unchecked="VersionFilter_Changed"/>
                            <CheckBox x:Name="ShowBetasCheckBox" Content="Beta/Alpha" Foreground="White" 
                                      IsChecked="False" Margin="0,0,20,0" Checked="VersionFilter_Changed" Unchecked="VersionFilter_Changed"/>
                        </StackPanel>

                        <!-- Version Selection -->
                        <TextBlock Text="Minecraft Version" Foreground="White" FontWeight="SemiBold" Margin="0,0,0,8"/>
                        <Grid Margin="0,0,0,20">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="10"/>
                                <ColumnDefinition Width="Auto"/>
                            </Grid.ColumnDefinitions>
                            <ComboBox x:Name="VersionComboBox" Grid.Column="0" Style="{StaticResource ModernComboBox}"
                                      SelectionChanged="VersionComboBox_SelectionChanged"/>
                            <Button x:Name="RefreshVersionsButton" Grid.Column="2" Content="ðŸ”„ Refresh" 
                                    Style="{StaticResource SecondaryButton}" Click="RefreshVersionsButton_Click"/>
                        </Grid>

                        <TextBlock Text="Mod Loader" Foreground="White" FontWeight="SemiBold" Margin="0,0,0,8"/>
                        <ComboBox x:Name="ModLoaderComboBox" Style="{StaticResource ModernComboBox}" Margin="0,0,0,20"
                                  SelectionChanged="ModLoaderComboBox_SelectionChanged">
                            <ComboBoxItem Content="None" Tag="none" IsSelected="True"/>
                            <ComboBoxItem Content="Fabric" Tag="fabric"/>
                            <ComboBoxItem Content="Forge" Tag="forge"/>
                            <ComboBoxItem Content="Quilt" Tag="quilt"/>
                        </ComboBox>

                        <StackPanel x:Name="ModLoaderVersionPanel" Visibility="Collapsed">
                            <TextBlock Text="Mod Loader Version" Foreground="White" FontWeight="SemiBold" Margin="0,0,0,8"/>
                            <Grid Margin="0,0,0,20">
                                <ComboBox x:Name="ModLoaderVersionComboBox" Style="{StaticResource ModernComboBox}"/>
                                <TextBlock x:Name="LoadingVersionsText" Text="Loading versions..." 
                                           Foreground="Gray" FontStyle="Italic" Margin="12,10" 
                                           Visibility="Collapsed" IsHitTestVisible="False"/>
                            </Grid>
                        </StackPanel>

                        <TextBlock Text="Icon" Foreground="White" FontWeight="SemiBold" Margin="0,0,0,8"/>
                        <ComboBox x:Name="IconComboBox" Style="{StaticResource ModernComboBox}" Margin="0,0,0,20">
                            <ComboBoxItem Content="ðŸ§± Grass Block" Tag="grass_block" IsSelected="True"/>
                            <ComboBoxItem Content="â›ï¸ Pickaxe" Tag="pickaxe"/>
                            <ComboBoxItem Content="ðŸ—¡ï¸ Sword" Tag="sword"/>
                            <ComboBoxItem Content="ðŸ° Castle" Tag="castle"/>
                            <ComboBoxItem Content="ðŸ”¥ Fire" Tag="fire"/>
                            <ComboBoxItem Content="ðŸ’Ž Diamond" Tag="diamond"/>
                            <ComboBoxItem Content="ðŸŒŸ Star" Tag="star"/>
                            <ComboBoxItem Content="ðŸŽ¯ Target" Tag="target"/>
                            <ComboBoxItem Content="ðŸš€ Rocket" Tag="rocket"/>
                        </ComboBox>
                    </StackPanel>

                    <!-- Right Column -->
                    <StackPanel Grid.Column="2">
                        <!-- Game Directory -->
                        <TextBlock Text="Game Directory" Foreground="White" FontWeight="SemiBold" Margin="0,0,0,8"/>
                        <Grid Margin="0,0,0,20">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="10"/>
                                <ColumnDefinition Width="Auto"/>
                            </Grid.ColumnDefinitions>
                            <TextBox x:Name="GameDirectoryTextBox" Grid.Column="0" Style="{StaticResource ModernTextBox}"/>
                            <Button Grid.Column="2" Content="ðŸ“ Browse" Style="{StaticResource SecondaryButton}"
                                    Click="BrowseGameDirectory_Click"/>
                        </Grid>

                        <!-- Java Settings -->
                        <TextBlock Text="Java Executable" Foreground="White" FontWeight="SemiBold" Margin="0,0,0,8"/>
                        <Grid Margin="0,0,0,20">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="10"/>
                                <ColumnDefinition Width="Auto"/>
                            </Grid.ColumnDefinitions>
                            <TextBox x:Name="JavaPathTextBox" Grid.Column="0" Style="{StaticResource ModernTextBox}"
                                     Text="Use system default"/>
                            <Button Grid.Column="2" Content="â˜• Browse" Style="{StaticResource SecondaryButton}"
                                    Click="BrowseJavaPath_Click"/>
                        </Grid>

                        <!-- Java Arguments -->
                        <TextBlock Text="JVM Arguments" Foreground="White" FontWeight="SemiBold" Margin="0,0,0,8"/>
                        <TextBox x:Name="JavaArgsTextBox" Style="{StaticResource ModernTextBox}" Margin="0,0,0,20"
                                 Text="-Xmx2G -Xms1G"/>

                        <!-- Memory Allocation Helper -->
                        <TextBlock Text="Memory Allocation" Foreground="White" FontWeight="SemiBold" Margin="0,0,0,8"/>
                        <Grid Margin="0,0,0,20">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="Auto"/>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="Auto"/>
                            </Grid.ColumnDefinitions>
                            <TextBlock Grid.Column="0" Text="1GB" Foreground="Gray" VerticalAlignment="Center"/>
                            <Slider x:Name="MemorySlider" Grid.Column="1" Minimum="1" Maximum="8" Value="2" 
                                    TickFrequency="1" IsSnapToTickEnabled="True" Margin="10,0"
                                    ValueChanged="MemorySlider_ValueChanged"/>
                            <TextBlock Grid.Column="2" Text="8GB" Foreground="Gray" VerticalAlignment="Center"/>
                        </Grid>
                        <TextBlock x:Name="MemoryLabel" Text="Allocated Memory: 2GB" Foreground="#00C851" 
                                   FontSize="12" Margin="0,-15,0,20" HorizontalAlignment="Center"/>
                    </StackPanel>
                </Grid>
            </ScrollViewer>

            <!-- Buttons -->
            <Grid Grid.Row="2">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="Auto"/>
                    <ColumnDefinition Width="15"/>
                    <ColumnDefinition Width="Auto"/>
                </Grid.ColumnDefinitions>
                
                <Button x:Name="CancelButton" Grid.Column="1" Content="Cancel" 
                        Style="{StaticResource ModernButton}" Padding="25,12" Click="CancelButton_Click"/>
                <Button x:Name="CreateButton" Grid.Column="3" Content="Create Installation" 
                        Style="{StaticResource PrimaryButton}" Padding="25,12" Click="CreateButton_Click"/>
            </Grid>
        </Grid>
    </Border>
</Window>